# frozen_string_literal: true

class Engine::Exploit::Unschedule < ApplicationService
  struct :exploit
  delegate :scheduler_handle, to: :exploit

  def call
    success! unschedule!
  end

  private

  def unschedule!
    return if scheduler_handle.nil? || scheduler_job.nil?

    scheduler_job.kill
  end

  memoize def scheduler_job
    scheduler.job(scheduler_handle)
  end

  def scheduler
    Rufus::Scheduler.singleton
  end
end
