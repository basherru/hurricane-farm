# frozen_string_literal: true

class Engine::Exploit::BeforeDestroy < ApplicationService
  struct :exploit

  def call
    success! process!
  end

  private

  def process!
    unshedule!
    update_handle!
  end

  def unshedule!
    return if exploit.scheduler_handle.nil?

    Engine::Exploit::Unschedule.call(exploit)
  end

  def update_handle!
    exploit.update_columns(scheduler_handle: nil)
  end
end
