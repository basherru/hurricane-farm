# frozen_string_literal: true

class Engine::Exploit::Schedule < ApplicationService
  struct :exploit
  delegate :teams, :period, to: :exploit

  def call
    success! schedule!
  end

  private

  def schedule!
    scheduler.every("#{period}s") { schedule_job! }
  end

  def schedule_job!
    teams.each { |team| ExploitJob.perform_later(team, exploit) }
  end

  def scheduler
    Rufus::Scheduler.singleton
  end
end
