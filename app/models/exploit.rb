# frozen_string_literal: true

class Exploit < ApplicationRecord
  has_and_belongs_to_many :teams
  has_many :flags

  validates :source, :period, :timeout, :title, presence: true

  enum status: { down: 0, up: 1 }

  after_save do
    handle = Engine::Exploit::Schedule.call(self).response

    update_columns(scheduler_handle: handle)
  end

  before_destroy do
    Engine::Exploit::Unschedule.call(self)

    update_columns(scheduler_handle: nil)
  end
end
